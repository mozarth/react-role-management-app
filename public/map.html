<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa Operacional</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        #header {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background-color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }
        
        #header h1 {
            margin: 0;
            font-size: 1.5rem;
        }
        
        .back-button {
            background: none;
            border: none;
            display: flex;
            align-items: center;
            font-size: 16px;
            color: #333;
            cursor: pointer;
        }
        
        .controls {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 8px 12px;
            background-color: white;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
        }
        
        .btn:hover {
            background-color: #f5f5f5;
        }
        
        .btn-blue {
            background-color: #e6f7ff;
            border-color: #91caff;
            color: #0057b8;
        }
        
        #filter-panel {
            position: absolute;
            top: 80px;
            left: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            padding: 12px;
            z-index: 999;
        }
        
        .filter-buttons {
            display: flex;
            gap: 8px;
        }
        
        .locate-btn {
            position: absolute;
            bottom: 30px;
            right: 20px;
            width: 50px;
            height: 50px;
            background-color: #0057b8;
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            z-index: 999;
        }
        
        #map {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            height: 100%;
            z-index: 1;
        }
    </style>
</head>
<body>
    <div id="header">
        <button class="back-button" onclick="window.location.href='/supervisor-panel'">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M15 18l-6-6 6-6"></path>
            </svg>
            Volver
        </button>
        
        <h1>Mapa Operacional</h1>
        
        <div class="controls">
            <button id="traffic-toggle" class="btn btn-blue">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="3" y1="9" x2="21" y2="9"></line>
                    <line x1="3" y1="15" x2="21" y2="15"></line>
                    <line x1="9" y1="3" x2="9" y2="21"></line>
                    <line x1="15" y1="3" x2="15" y2="21"></line>
                </svg>
                Tráfico
            </button>
            <button id="fullscreen-toggle" class="btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path>
                </svg>
            </button>
        </div>
    </div>
    
    <div id="filter-panel">
        <div class="filter-buttons">
            <button id="filter-all" class="btn">Todo</button>
            <button id="filter-patrols" class="btn">Patrullas</button>
            <button id="filter-alarms" class="btn">Alarmas</button>
        </div>
    </div>
    
    <button id="locate-btn" class="locate-btn">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polygon points="3 11 22 2 13 21 11 13 3 11"></polygon>
        </svg>
    </button>
    
    <div id="map"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializar mapa
            var map = L.map('map').setView([25.674, -100.309], 13);
            
            // Capa base de OpenStreetMap
            var baseLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                maxZoom: 19
            }).addTo(map);
            
            // Capa de tráfico de Thunderforest
            var trafficLayer = L.tileLayer('https://{s}.tile.thunderforest.com/transport/{z}/{x}/{y}.png?apikey=6170aad10dfd42a38d4d8c709a536f38', {
                attribution: '&copy; <a href="http://www.thunderforest.com/">Thunderforest</a>, &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                maxZoom: 22,
                opacity: 0.7
            }).addTo(map);

            var showTraffic = true;
            
            // Crear íconos personalizados
            var patrolIcon = L.icon({
                iconUrl: 'https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/images/marker-icon.png',
                shadowUrl: 'https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/images/marker-shadow.png',
                iconSize: [25, 41],
                iconAnchor: [12, 41],
                popupAnchor: [1, -34]
            });
            
            var alarmIcon = L.icon({
                iconUrl: 'https://cdn.jsdelivr.net/gh/pointhi/leaflet-color-markers@master/img/marker-icon-red.png',
                shadowUrl: 'https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/images/marker-shadow.png',
                iconSize: [25, 41],
                iconAnchor: [12, 41],
                popupAnchor: [1, -34]
            });
            
            // Ubicaciones simuladas de patrullas
            var patrolLocations = [
                {
                    position: [25.674, -100.309],
                    title: 'Patrulla 001',
                    popupContent: 'En ruta a emergencia. ETA: 5 min.'
                },
                {
                    position: [25.680, -100.320],
                    title: 'Patrulla 002',
                    popupContent: 'Disponible para asignación.'
                },
                {
                    position: [25.665, -100.295],
                    title: 'Patrulla 003',
                    popupContent: 'En inspección programada.'
                }
            ];
            
            // Ubicaciones simuladas de alarmas
            var alarmLocations = [
                {
                    position: [25.672, -100.315],
                    title: 'Banco Nacional',
                    popupContent: 'Alarma de intrusión activa. Prioridad: Alta'
                },
                {
                    position: [25.685, -100.305],
                    title: 'Centro Comercial Este',
                    popupContent: 'Alarma de pánico. Prioridad: Crítica'
                }
            ];
            
            // Capas de marcadores
            var patrolMarkersLayer = L.layerGroup();
            var alarmMarkersLayer = L.layerGroup();
            
            // Añadir marcadores de patrullas
            patrolLocations.forEach(function(patrol) {
                var marker = L.marker(patrol.position, {icon: patrolIcon})
                    .bindPopup('<strong>' + patrol.title + '</strong><br>' + patrol.popupContent);
                patrolMarkersLayer.addLayer(marker);
            });
            
            // Añadir marcadores de alarmas
            alarmLocations.forEach(function(alarm) {
                var marker = L.marker(alarm.position, {icon: alarmIcon})
                    .bindPopup('<strong>' + alarm.title + '</strong><br>' + alarm.popupContent);
                alarmMarkersLayer.addLayer(marker);
            });
            
            // Añadir capas al mapa
            patrolMarkersLayer.addTo(map);
            alarmMarkersLayer.addTo(map);
            
            // Función para alternar el modo de pantalla completa
            document.getElementById('fullscreen-toggle').addEventListener('click', function() {
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen();
                    this.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="4 14 10 14 10 20"></polyline><polyline points="20 10 14 10 14 4"></polyline><line x1="14" y1="10" x2="21" y2="3"></line><line x1="3" y1="21" x2="10" y2="14"></line></svg>';
                } else {
                    if (document.exitFullscreen) {
                        document.exitFullscreen();
                        this.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path></svg>';
                    }
                }
            });
            
            // Alternar capa de tráfico
            document.getElementById('traffic-toggle').addEventListener('click', function() {
                if (showTraffic) {
                    map.removeLayer(trafficLayer);
                    this.classList.remove('btn-blue');
                } else {
                    map.addLayer(trafficLayer);
                    this.classList.add('btn-blue');
                }
                showTraffic = !showTraffic;
            });
            
            // Filtros de marcadores
            document.getElementById('filter-all').addEventListener('click', function() {
                map.addLayer(patrolMarkersLayer);
                map.addLayer(alarmMarkersLayer);
            });
            
            document.getElementById('filter-patrols').addEventListener('click', function() {
                map.addLayer(patrolMarkersLayer);
                map.removeLayer(alarmMarkersLayer);
            });
            
            document.getElementById('filter-alarms').addEventListener('click', function() {
                map.removeLayer(patrolMarkersLayer);
                map.addLayer(alarmMarkersLayer);
            });
            
            // Botón de localización
            document.getElementById('locate-btn').addEventListener('click', function() {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(function(position) {
                        var lat = position.coords.latitude;
                        var lng = position.coords.longitude;
                        map.setView([lat, lng], 15);
                    }, function(error) {
                        console.error('Error obteniendo ubicación:', error);
                        alert('No se pudo obtener su ubicación. Verifique los permisos de su navegador.');
                    });
                } else {
                    alert('La geolocalización no está soportada en este navegador.');
                }
            });
        });
    </script>
</body>
</html>